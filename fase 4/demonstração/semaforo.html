<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semaforo Inteligente - Fase 4</title>
    <style>
        /* --- CSS NOVO E MELHORADO --- */
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            /* Fundo degrad√™ moderno (Estilo Dark Mode/Urbano) */
            background: radial-gradient(circle at center, #3a404d 0%, #1a1c20 100%);
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { 
            margin-bottom: 5px; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            font-weight: 300;
            letter-spacing: 1px;
        }
        .subtitle { 
            color: #95a5a6; 
            margin-bottom: 40px; 
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .container {
            display: flex;
            gap: 60px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }

        /* --- O NOVO SEM√ÅFORO --- */
        .traffic-light {
            background-color: #2c3e50;
            padding: 25px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            /* Efeito 3D na caixa do sem√°foro */
            box-shadow: 
                15px 15px 30px rgba(0,0,0,0.6), 
                inset 2px 2px 5px rgba(255,255,255,0.1),
                inset -2px -2px 5px rgba(0,0,0,0.5);
            border: 6px solid #1a252f;
            position: relative;
        }

        /* Haste do sem√°foro (detalhe visual) */
        .traffic-light::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #1a252f;
        }

        .light {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background-color: #111; /* Cor da luz apagada (vidro escuro) */
            border-top: 4px solid #000; /* Efeito de profundidade */
            transition: all 0.2s ease-in-out;
            opacity: 0.3; /* Apagado fica meio transparente */
        }

        /* Classes ATIVAS com brilho intenso (Glow) */
        .red.active { 
            background-color: #ff3b30; 
            opacity: 1;
            box-shadow: 0 0 30px #ff3b30, inset 0 0 20px #ff9f9a;
        }
        .yellow.active { 
            background-color: #ffcc00; 
            opacity: 1;
            box-shadow: 0 0 30px #ffcc00, inset 0 0 20px #ffeebb;
        }
        .green.active { 
            background-color: #4cd964; 
            opacity: 1;
            box-shadow: 0 0 30px #4cd964, inset 0 0 20px #aaffb8;
        }

        /* --- PAINEL DE CONTROLE (Mantido limpo) --- */
        .control-panel {
            background: rgba(255, 255, 255, 0.05); /* Vidro fosco */
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            width: 300px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h3 { border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 0; }

        .control-group { margin-bottom: 25px; }
        
        label { display: block; margin-bottom: 10px; font-weight: 500; font-size: 0.95rem; cursor: pointer; }
        
        /* Slider personalizado */
        input[type="range"] {
            width: 100%;
            accent-color: #3498db;
        }
        
        /* Checkboxes maiores */
        input[type="checkbox"] {
            transform: scale(1.2);
            margin-right: 10px;
            accent-color: #e74c3c;
        }

        .status-box {
            background-color: #1e272e;
            color: #00d2d3;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Consolas', 'Courier New', monospace;
            height: 130px;
            overflow-y: auto;
            margin-top: 20px;
            font-size: 0.85em;
            border: 1px solid #333;
            box-shadow: inset 0 0 10px #000;
        }

        /* Scrollbar bonitinha para o log */
        .status-box::-webkit-scrollbar { width: 8px; }
        .status-box::-webkit-scrollbar-track { background: #1e272e; }
        .status-box::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }

    </style>
</head>
<body>

    <h1>üö¶ Sem√°foro Inteligente MVP</h1>
    <div class="subtitle">Fase 4 - Algoritmo Adaptativo</div>

    <div class="container">
        <div class="traffic-light">
            <div id="light-red" class="light red"></div>
            <div id="light-yellow" class="light yellow"></div>
            <div id="light-green" class="light green"></div>
        </div>

        <div class="control-panel">
            <h3>‚öôÔ∏è Simula√ß√£o de Sensores</h3>
            
            <div class="control-group">
                <label>Fluxo de Ve√≠culos: <span id="flow-value">10</span>/min</label>
                <input type="range" id="sensor-flow" min="0" max="100" value="10">
                <small style="color:#bdc3c7; font-size: 0.8em;"> > 60 ativa modo Fluxo Alto</small>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="sensor-rain"> üåßÔ∏è Sensor de Chuva
                </label>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="sensor-server" checked> üì° Conex√£o Nuvem
                </label>
            </div>

            <div class="control-group">
                <label style="color: #ff6b6b;">
                    <input type="checkbox" id="sensor-fail"> ‚ö†Ô∏è Falha (Modo Seguro)
                </label>
            </div>

            <div class="status-box" id="system-log">
                > Booting System...<br>
                > Sensors Online.<br>
                > Ready.
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes Padr√£o
        const TEMPO_VERDE_PADRAO = 3000; 
        const TEMPO_AMARELO_PADRAO = 1000; 
        const TEMPO_VERMELHO_PADRAO = 3000;

        // Estado do Sistema
        let historicoFluxo = []; 
        let modoSegurancaAtivo = false;

        // Refer√™ncias HTML
        const lights = {
            red: document.getElementById('light-red'),
            yellow: document.getElementById('light-yellow'),
            green: document.getElementById('light-green')
        };
        const log = document.getElementById('system-log');
        const flowSlider = document.getElementById('sensor-flow');
        const flowDisplay = document.getElementById('flow-value');

        // Atualiza valor do slider na tela
        flowSlider.addEventListener('input', (e) => {
            flowDisplay.innerText = e.target.value;
        });

        // Fun√ß√£o de Log
        function addLog(msg) {
            const time = new Date().toLocaleTimeString().split(' ')[0];
            log.innerHTML = `[${time}] ${msg}<br>` + log.innerHTML;
        }

        // Fun√ß√£o para apagar todas as luzes
        function resetLights() {
            lights.red.classList.remove('active');
            lights.yellow.classList.remove('active');
            lights.green.classList.remove('active');
        }

        // --- ALGORITMO PRINCIPAL ---

        async function executarCiclo() {
            const fluxo = parseInt(document.getElementById('sensor-flow').value);
            const chovendo = document.getElementById('sensor-rain').checked;
            const servidorOnline = document.getElementById('sensor-server').checked;
            const falhaSensor = document.getElementById('sensor-fail').checked;

            historicoFluxo.push(fluxo);
            if(historicoFluxo.length > 5) historicoFluxo.shift();

            if (falhaSensor) {
                if (!modoSegurancaAtivo) {
                    modoSegurancaAtivo = true;
                    addLog("‚ùå FALHA CR√çTICA! Iniciando Modo Seguran√ßa.");
                    piscarAmarelo();
                }
                return; 
            } else {
                modoSegurancaAtivo = false;
            }

            let modoOperacao = servidorOnline ? "ONLINE" : "LOCAL";
            
            let tempoVerde = TEMPO_VERDE_PADRAO;
            let tempoAmarelo = TEMPO_AMARELO_PADRAO;
            let msgDecisao = "";

            if (fluxo > 60) {
                tempoVerde += 2000; 
                msgDecisao += " | ‚¨ÜÔ∏è Fluxo Alto";
            }

            if (chovendo) {
                tempoAmarelo += 1500; 
                msgDecisao += " | üåßÔ∏è Pista Molhada";
            }

            // Fase VERDE
            addLog(`üü¢ VERDE (${modoOperacao}) ${msgDecisao}`);
            resetLights();
            lights.green.classList.add('active');
            await sleep(tempoVerde);

            if(checkInterruption()) return;

            // Fase AMARELA
            addLog(`üü° AMARELO (${tempoAmarelo/1000}s)`);
            resetLights();
            lights.yellow.classList.add('active');
            await sleep(tempoAmarelo);

            if(checkInterruption()) return;

            // Fase VERMELHA
            addLog(`üî¥ VERMELHO`);
            resetLights();
            lights.red.classList.add('active');
            await sleep(TEMPO_VERMELHO_PADRAO);

            if(checkInterruption()) return;

            executarCiclo();
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function piscarAmarelo() {
            while (document.getElementById('sensor-fail').checked) {
                resetLights();
                await sleep(500);
                lights.yellow.classList.add('active');
                await sleep(500);
            }
            addLog("‚úÖ Sensor recuperado. Reiniciando...");
            executarCiclo();
        }

        function checkInterruption() {
            if (document.getElementById('sensor-fail').checked && !modoSegurancaAtivo) {
                executarCiclo(); 
                return true;
            }
            return false;
        }

        setTimeout(executarCiclo, 1000);

    </script>
</body>
</html>