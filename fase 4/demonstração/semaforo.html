<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semaforo Inteligente - Entrega Final</title>
    <style>
        /* --- VISUAL ESTILO DARK (Mantido) --- */
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at center, #3a404d 0%, #1a1c20 100%);
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); font-weight: 300; letter-spacing: 1px; }
        .subtitle { color: #95a5a6; margin-bottom: 40px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; }

        .container {
            display: flex;
            gap: 60px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }

        /* --- SEM√ÅFORO 3D --- */
        .traffic-light {
            background-color: #2c3e50;
            padding: 25px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            box-shadow: 15px 15px 30px rgba(0,0,0,0.6), inset 2px 2px 5px rgba(255,255,255,0.1), inset -2px -2px 5px rgba(0,0,0,0.5);
            border: 6px solid #1a252f;
            position: relative;
        }
        .traffic-light::before {
            content: ''; position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 20px; background: #1a252f;
        }

        .light {
            width: 90px; height: 90px; border-radius: 50%;
            background-color: #111; border-top: 4px solid #000;
            transition: all 0.2s ease-in-out; opacity: 0.3;
        }

        .red.active { background-color: #ff3b30; opacity: 1; box-shadow: 0 0 30px #ff3b30, inset 0 0 20px #ff9f9a; }
        .yellow.active { background-color: #ffcc00; opacity: 1; box-shadow: 0 0 30px #ffcc00, inset 0 0 20px #ffeebb; }
        .green.active { background-color: #4cd964; opacity: 1; box-shadow: 0 0 30px #4cd964, inset 0 0 20px #aaffb8; }

        /* --- PAINEL --- */
        .control-panel {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            padding: 30px; border-radius: 15px; width: 300px;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h3 { border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; margin-top: 0; }
        .control-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; font-weight: 500; cursor: pointer; }
        input[type="range"] { width: 100%; accent-color: #3498db; }
        input[type="checkbox"] { transform: scale(1.2); margin-right: 10px; accent-color: #e74c3c; }

        .status-box {
            background-color: #1e272e; color: #00d2d3; padding: 15px;
            border-radius: 6px; font-family: 'Consolas', 'Courier New', monospace;
            height: 130px; overflow-y: auto; margin-top: 20px; font-size: 0.85em;
            border: 1px solid #333;
        }
    </style>
</head>
<body>

    <h1>üö¶ Sem√°foro Inteligente</h1>
    <div class="subtitle">Demonstra√ß√£o de L√≥gica de Controle</div>

    <div class="container">
        <div class="traffic-light">
            <div id="light-red" class="light red"></div>
            <div id="light-yellow" class="light yellow"></div>
            <div id="light-green" class="light green"></div>
        </div>

        <div class="control-panel">
            <h3>‚öôÔ∏è Sensores (Entradas)</h3>
            
            <div class="control-group">
                <label>Fluxo: <span id="flow-value">10</span> carros/min</label>
                <input type="range" id="sensor-flow" min="0" max="100" value="10">
                <small style="color:#bdc3c7">Acima de 60 = Fluxo Alto</small>
            </div>

            <div class="control-group">
                <label><input type="checkbox" id="sensor-rain"> üåßÔ∏è Chuva Forte</label>
            </div>

            <div class="control-group">
                <label><input type="checkbox" id="sensor-server" checked> üì° Servidor Conectado</label>
            </div>

            <div class="control-group">
                <label style="color: #ff6b6b;"><input type="checkbox" id="sensor-fail"> ‚ö†Ô∏è Quebrar Sensor</label>
            </div>

            <div class="status-box" id="system-log">
                > Sistema Iniciado.<br>
            </div>
        </div>
    </div>

    <script>
        const TEMPO_VERDE_BASE = 3000; 
        const TEMPO_AMARELO_BASE = 1000; 
        const TEMPO_VERMELHO_BASE = 3000;

        let modoSegurancaAtivo = false;
        
        // Refer√™ncias HTML
        const lights = {
            red: document.getElementById('light-red'),
            yellow: document.getElementById('light-yellow'),
            green: document.getElementById('light-green')
        };
        const log = document.getElementById('system-log');
        
        // Atualiza numero slider
        document.getElementById('sensor-flow').addEventListener('input', (e) => {
            document.getElementById('flow-value').innerText = e.target.value;
        });

        function addLog(msg) {
            const time = new Date().toLocaleTimeString().split(' ')[0];
            log.innerHTML = `[${time}] ${msg}<br>` + log.innerHTML;
        }

        function resetLights() {
            lights.red.classList.remove('active');
            lights.yellow.classList.remove('active');
            lights.green.classList.remove('active');
        }

        // --- ALGORITMO PRINCIPAL ---
        async function executarCiclo() {
            // Ler dados (Entradas)
            const fluxo = parseInt(document.getElementById('sensor-flow').value);
            const chuva = document.getElementById('sensor-rain').checked;
            const servidorOnline = document.getElementById('sensor-server').checked;
            const falhaSensor = document.getElementById('sensor-fail').checked;

            // ====================================================
            // REGRA 3: Se sensor falhar -> Modo Seguran√ßa (Pisca Amarelo)
            // ====================================================
            if (falhaSensor) {
                if (!modoSegurancaAtivo) {
                    modoSegurancaAtivo = true;
                    addLog("‚ùå ERRO: Sensor Falhou. ATIVANDO MODO SEGURAN√áA.");
                    piscarAmarelo();
                }
                return; // Encerra o ciclo normal
            } else {
                modoSegurancaAtivo = false;
            }

            // ====================================================
            // REGRA 4: Se servidor cair -> Rodar Localmente
            // ====================================================
            let modoStr = "";
            if (servidorOnline) {
                modoStr = "NUVEM";
            } else {
                modoStr = "LOCAL";
                // O c√≥digo continua rodando, mas agora em modo 'Local'
            }

            // Ajuste dos Tempos
            let tVerde = TEMPO_VERDE_BASE;
            let tAmarelo = TEMPO_AMARELO_BASE;
            let msgLog = "";

            // ====================================================
            // REGRA 1: Se Fluxo Alto -> Aumentar Verde
            // ====================================================
            if (fluxo > 60) {
                tVerde += 3000; // Adiciona 3 segundos
                msgLog += " | ‚¨ÜÔ∏è Fluxo Alto (+Verde)";
            }

            // ====================================================
            // REGRA 2: Se Chuva -> Reduzir Velocidade e Aumentar Amarelo
            // ====================================================
            if (chuva) {
                tAmarelo += 2000; // Adiciona 2 segundos de frenagem
                msgLog += " | üåßÔ∏è Chuva (Velocidade Reduzida/Mais Amarelo)";
            }

            // --- EXECU√á√ÉO DAS LUZES ---
            
            // SINAL VERDE
            addLog(`üü¢ VERDE [${modoStr}] ${msgLog}`);
            resetLights();
            lights.green.classList.add('active');
            await sleep(tVerde);
            if(checkFail()) return;

            // SINAL AMARELO
            addLog(`üü° AMARELO (${tAmarelo/1000}s) - Aten√ß√£o`);
            resetLights();
            lights.yellow.classList.add('active');
            await sleep(tAmarelo);
            if(checkFail()) return;

            // SINAL VERMELHO
            addLog(`üî¥ VERMELHO`);
            resetLights();
            lights.red.classList.add('active');
            await sleep(TEMPO_VERMELHO_BASE);
            if(checkFail()) return;

            // Reinicia loop
            executarCiclo();
        }

        // Fun√ß√µes Auxiliares
        function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

        async function piscarAmarelo() {
            while (document.getElementById('sensor-fail').checked) {
                resetLights();
                await sleep(500);
                lights.yellow.classList.add('active');
                await sleep(500);
            }
            addLog("‚úÖ Sensor reparado. Reiniciando...");
            executarCiclo();
        }

        function checkFail() {
            if (document.getElementById('sensor-fail').checked && !modoSegurancaAtivo) {
                executarCiclo(); return true;
            }
            return false;
        }

        // Iniciar
        setTimeout(executarCiclo, 1000);

    </script>
</body>
</html>